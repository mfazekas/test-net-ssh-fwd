---
- hosts: all
  sudo: yes
  vars:
    ruby_version: '2.0.0-p598'
    rvm1_install_path: '/usr/local/rvm'
    foopwd: "$6$mhOzf/yapZwS$3RwDl4GfWZ5VcfcsHrK9xNNTxyzLOJBsmMttDNaegIbXxMahV86.v/5HsNtit16MEl0EFf5CSW8Dz2yXV.8GB0"
    foo2pwd: "$6$JiB7y7.M0yI$Abt.ZGIc4DwkRWeI6nKxzzPUZcux7hLRXSdpoKoZvswJz1SZyg5GRQWn9pGID0dgC6e4wFglfW6ev/qZoTqGk/"
  pre_tasks:
    - name: get currently installed ruby version
      command: "{{rvm1_install_path}}/rubies/ruby-{{ruby_version}}/bin/ruby -e 'puts \"#{RUBY_VERSION}-p#{RUBY_PATCHLEVEL}\"'"
      register: current_ruby_version
      ignore_errors: True
  roles:
    - { role: rvm_io.rvm1-ruby,
        tags: ruby, sudo: True, 
        rvm1_rubies: ["ruby-{{ruby_version}}"],
        rvm1_install_path: "{{rvm1_install_path}}",
        when: "'{{current_ruby_version.stdout|default()}}' != '{{ruby_version}}'" }
  tasks:
  - user: name=foo password="{{foopwd}}" group=vagrant state=present
  - user: name=foo2 password="{{foo2pwd}}" group=vagrant state=present
  - gem: name="{{item}}" state=present executable=/usr/local/bin/gem
    with_items:
      - byebug
      - ffi
  - apt: name="{{item}}" state=present
    with_items:
      - expect
      - whois


